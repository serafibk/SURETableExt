<!DOCTYPE html>
<html>
<!--this is css part-->
<style>
	#table{
		position: absolute; top: 0px; left: 0px;
		z-index:-1;
	}
	button{
		position: relative;
	}
	.json{
		position: relative;
	}
	#fr{
		position: relative; width:100px;height:100px;
	}	

</style>
<body onload = "imgDim()" onkeypress="printCoords()" >
<div id="container" onmousedown="mouseDown()" onmouseup="mouseUp()" onmousemove="mouseMove()"> 
	<img id="table" src=""></img>
</div>
<form action = "http://localhost:8080" method="POST" target = "submitCoords">
	<textarea class = "json" name = "JSON" type="text" id ="json"></textarea>
	<button id ="but" type="submit" onclick="newTable()">Get Coordinates</button>
</form>
<iframe name = "submitCoords" id = "fr"></iframe>

<!--script to record drawn rectangles-->
<script>
var isDown=false; 
var row =0;
var col =0;
var startX,finalX,startY,finalY,rect;
var allCoords={
	table:[]
};
var rowCol={
	rc:[]
};
function mouseDown(){
	rect = document.createElement("canvas");
	rect.width = document.getElementById("table").clientWidth;
	rect.height = document.getElementById("table").clientHeight;
	rect.style.cssText = "position:absolute;top:0px;left:0px;";
	document.getElementById("container").appendChild(rect);
	isDown=true;
	startX = event.clientX-rect.getBoundingClientRect().left;
	startY = event.clientY-rect.getBoundingClientRect().top;
	rect.style.cursor = "crosshair";
}

function mouseMove(){
	if(isDown){
		var ctx = rect.getContext("2d");
		ctx.clearRect(0,0,rect.width,rect.height);
		finalX = event.clientX-rect.getBoundingClientRect().left;
		finalY = event.clientY-rect.getBoundingClientRect().top;
		ctx.lineWidth = 1;
		ctx.strokeStyle = "black";
		ctx.strokeRect(startX,startY,finalX-startX,finalY-startY);
		rect.style.cursor = "default";
	}

	
}
function mouseUp(){
	isDown=false;
	var points = {minX:startX, minY:startY, maxX:finalX, maxY:finalY};
	allCoords.table.push(points);
}

function imgDim(){
	document.getElementById("table").src = localStorage.getItem("imgSrc");

	var width = document.getElementById("table").offsetWidth;
	var height = document.getElementById("table").offsetHeight;
	document.getElementById("but").style.left = "0px";
	document.getElementById("but").style.top = height+'px';
	document.getElementById("json").style.left = "0px";
	document.getElementById("json").style.top = height+'px';
	document.getElementById("fr").style.left = "0px";
	document.getElementById("fr").style.top = height+'px';
}
function printCoords(){
	var k = event.key;
	if(k == 'z'){
		var ctx = rect.getContext("2d");
		ctx.clearRect(startX-5,startY-5,finalX-startX+10,finalY-startY+10);
		allCoords.table.pop();
	}
	else{
		var json = JSON.stringify(allCoords);
		document.getElementById("json").innerHTML = json;
		console.log(document.getElementById("json").innerHTML);
	}	
}
function newTable(){
	allCoords.table = [];
}

</script>

</body>
</html>
